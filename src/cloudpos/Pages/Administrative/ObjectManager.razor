@page "/Administrative/ObjectManager"
@layout Shared.AdminPageLayout

<h2>객체 관리자</h2>
<div class="container-md my-5 w-75">
    <div class="d-flex justify-content-center mb-4">
        <div class="btn-group btn-group" role="group">
            <button class="btn @(Mode=="Category" ? "btn-primary" : "btn-outline-primary")"
                    @onclick='() => SelectMode("Category")'>
                카테고리
            </button>
            <button class="btn @(Mode=="Item" ? "btn-primary" : "btn-outline-primary")"
                    @onclick='() => SelectMode("Item")'>
                메뉴
            </button>
            <button class="btn @(Mode=="Table" ? "btn-primary" : "btn-outline-primary")"
                    @onclick='() => SelectMode("Table")'>
                테이블
            </button>
        </div>
    </div>

    @if(Mode=="Category")
    {
        <div class="container mx-auto">
            <button class="btn btn-success mb-3" @onclick="AddCategory">+ 추가</button>
            <div class="row fw-bold border-bottom py-2 gx-0">
                <div class="col mx-5">이름</div>
                <div class="col text-end mx-5">수정/삭제</div>
            </div>
            
            @foreach(var c in Categories)
            {
                <div class="row align-items-center border-bottom py-2 gx-0">
                    <div class="col mx-5">@c.Name</div>
                    <div class="col text-end me-4">
                        <button class="btn btn-outline-secondary btn-sm me-2"
                                @onclick="() => EditCategory(c)">
                            수정
                        </button>
                        <button class="btn btn-outline-danger btn-sm"
                                @onclick="() => DeleteCategory(c.CategoryId)">
                            삭제
                        </button>
                    </div>
                </div>
            }
        </div>

        // 카테고리 모달
        @if(IsCategoryModalOpen)
        {
            <div class="modal-backdrop fade show"></div>
            <div class="modal d-block">
                <div class="modal-dialog">
                    <div class="modal-content p-3">
                        <h5>@(EditingCategory.CategoryId==0?"새 카테고리":"카테고리 수정")</h5>
                        <EditForm Model="EditingCategory" OnValidSubmit="SaveCategoryAsync">
                            <InputText @bind-Value="EditingCategory.Name" class="form-control" />
                            <div class="mt-3 text-end">
                                <button class="btn btn-secondary me-2" @onclick="CloseCategoryModal">취소</button>
                                <button class="btn btn-primary" type="submit">저장</button>
                            </div>
                        </EditForm>
                    </div>
                </div>
            </div>
        }
    }
    else if(Mode=="Item")
    {
        <div class="container mx-auto">
            <button class="btn btn-success mb-3" @onclick="AddItem">+ 추가</button>
            <div class="row text-center fw-bold border-bottom py-2 gx-0">
                <div class="col">카테고리</div>
                <div class="col">이름</div>
                <div class="col">가격</div>
                <div class="col">판매여부</div>
                <div class="col">수정/삭제</div>
            </div>
            
            @foreach(var i in Items)
            {
                <div class="row align-items-center text-center border-bottom py-2 gx-0">
                    <div class="col">@i.Category.Name</div>
                    <div class="col">@i.Name</div>
                    <div class="col">@i.Price</div>
                    <div class="col">@((i.IsAvailable) ? "✅" : "⛔")</div>
                    <div class="col d-flex justify-content-center">
                        <button class="btn btn-outline-secondary btn-sm me-2"
                                @onclick="() => EditItem(i)">
                            수정
                        </button>
                        <button class="btn btn-outline-danger btn-sm"
                                @onclick="() => DeleteItem(i.ItemId)">
                            삭제
                        </button>
                    </div>
                </div>
            }
        </div>

        // 메뉴 모달
        @if(IsItemModalOpen)
        {
            <div class="modal-backdrop fade show"></div>
            <div class="modal d-block">
                <div class="modal-dialog">
                    <div class="modal-content p-3">
                        <h5>@(EditingItem.ItemId==0?"새 메뉴":"메뉴 수정")</h5>
                        <EditForm Model="EditingItem" OnValidSubmit="SaveItemAsync">
                            <div class="mb-2">
                                <label>카테고리</label>
                                <InputSelect @bind-Value="EditingItem.CategoryId" class="form-select">
                                    @foreach (var c in Categories)
                                    {
                                        <option value="@c.CategoryId">@c.Name</option>
                                    }
                                </InputSelect>
                            </div>
                            <div class="mb-2">
                                <label>이름</label>
                                <InputText @bind-Value="EditingItem.Name" class="form-control" />
                            </div>
                            <div class="mb-2">
                                <label>가격</label>
                                <InputNumber @bind-Value="EditingItem.Price" class="form-control" />
                            </div>
                            <div class="form-check mb-2">
                                <InputCheckbox @bind-Value="EditingItem.IsAvailable"
                                               class="form-check-input" id="avail" />
                                <label class="form-check-label" for="avail">판매 가능</label>
                            </div>
                            <div class="mt-3 text-end">
                                <button class="btn btn-secondary me-2" @onclick="CloseItemModal">취소</button>
                                <button class="btn btn-primary" type="submit">저장</button>
                            </div>
                        </EditForm>
                    </div>
                </div>
            </div>
        }
    }
</div>

